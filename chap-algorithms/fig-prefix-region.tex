\begin{tikzpicture}[node distance=2.25cm]
	\matrix (him locations) [nodes={rectangle,draw,minimum width=6.5mm}]{
		\node (index 2)  {2}; \\
		\node [fill=lightgray](index 6)  {6}; \\
		\node (index 10) {10}; \\
		\node (index 15) {15}; \\
	};


	\matrix (him X it locations) [nodes={rectangle,draw,minimum width=12mm},right of=him locations,node distance=1.75cm]{
		\node (index 2 4)   {$2, 4$}; \\
		\node (index 2 8)   {$2, 8$}; \\
		\node (index 2 13)  {$2, 13$}; \\
		\node [fill=lightgray](index 6 8)   {$6, 8$}; \\
		\node [fill=lightgray](index 6 13)  {$6, 13$}; \\
		\node (index 10 13) {$10, 13$}; \\
	};


	\matrix (it locations) [nodes={rectangle,draw,minimum width=6.5mm},right of=him X it locations,node distance=1.75cm]{
		\node (index 0)  {0}; \\
		\node (index 4)  {4}; \\
		\node [fill=lightgray](index 8)  {8}; \\
		\node [fill=lightgray](index 13) {13}; \\
	};

	\draw[snake=brace,raise snake=1mm] (index 0.north east) -- (index 4.south east);
	\draw[snake=brace,raise snake=1mm] (index 8.north east) -- (index 13.south east);
%	\node [anchor=west,right=2mm] at (index 0.south east) {$(6) \ddot{>} q_{X~it}$};
%	\node [anchor=west,right=2mm] at (index 8.south east) {$(6) \ddot{=} q_{X~it}$};
	\node [anchor=west,right=2mm] at (index 0.south east) {$\ddot{>}$};
	\node (equal)[anchor=west,right=2mm] at (index 8.south east) {$\ddot{=}$};
	\node [anchor=north,below=4mm] at (equal.south) {$\ddot{<}$ is $\emptyset$};

	\node (him label) [anchor=south] at (him locations.north) {$M_{him~X}$};
	\node (pair label) [anchor=south] at (him X it locations.north) {$M_{him~X~it}$};
	\node (it label) [anchor=south] at (it locations.north) {$M_{X~it}$};
	\node [anchor=south] at (him label.north) {Input};
	\node [anchor=south] at (pair label.north) {Output};
	\node [anchor=south] at  (it label.north) {Input};

	\fill[lightgray] 
		(index 6.south east) --
		(index 6.north east) --
		(index 6 8.north west) --
		(index 6 13.south west) -- cycle;

	\fill[lightgray] 
		(index 6 13.south east) --
		(index 6 8.north east) --
		(index 8.north west) --
		(index 13.south west) -- cycle;
		

	\draw[->] (index 2.east) -- (index 2 4.west);
	\draw[->] (index 2.east) -- (index 2 8.west);
	\draw[->] (index 2.east) -- (index 2 13.west);
	\draw[->] (index 6.east) -- (index 6 8.west);
	\draw[->] (index 6.east) -- (index 6 13.west);
	\draw[->] (index 10.east) -- (index 10 13.west);

	\draw[->] (index 4.west) -- (index 2 4.east);
	\draw[->] (index 8.west) -- (index 2 8.east);
	\draw[->] (index 8.west) -- (index 6 8.east);
	\draw[->] (index 13.west) -- (index 2 13.east);
	\draw[->] (index 13.west) -- (index 6 13.east);
	\draw[->] (index 13.west) -- (index 10 13.east);


	\node (between)[right of=it locations,node distance=1.5cm] {};
	\draw[gray,thin] (between.center) -- +(0cm, 4cm);
	\draw[gray,thin] (between.center) -- +(0cm,-3cm);

	\matrix (it X him locations) [nodes={rectangle,draw,minimum width=12mm},right of=it locations,node distance=3cm]{
		\node (index 0 2)   {$0,2$}; \\
		\node (index 0 6)   {$0,6$}; \\
		\node (index 0 10)   {$0,10$}; \\
		\node [fill=lightgray](index 4 6)   {$4,6$}; \\
		\node (index 4 10)   {$4,10$}; \\
		\node (index 4 15)   {$4,15$}; \\
		\node (index 8 10)   {$8,10$}; \\
		\node (index 8 15)   {$8,15$}; \\
		\node (index 13 15)  {$13,15$}; \\
	};

	\matrix (it X him X it locations) [nodes={rectangle,draw,minimum width=17mm},right of=it X him locations,node distance=2.75cm]{
		\node (index 0 2 4)  {$0,2,4$}; \\
		\node (index 0 2 8)  {$0,2,8$}; \\
		\node (index 0 2 13)  {$0,2,13$}; \\
		\node (index 0 6 8)  {$0,6,8$}; \\
		\node (index 0 6 13)  {$0,6,13$}; \\
		\node (index 0 10 13)  {$0,10,13$}; \\
		\node [fill=lightgray](index 4 6 8)  {$4,6,8$}; \\
		\node [fill=lightgray](index 4 6 13)  {$4,6,13$}; \\
		\node (index 4 10 13)  {$4,10,13$}; \\
		\node (index 8 10 13)  {$8,10,13$}; \\
	};


	\matrix (him X it locations) [nodes={rectangle,draw,minimum width=12mm},right of=it X him X it locations,node distance=2.75cm]{
		\node (index 2 4)   {$2, 4$}; \\
		\node (index 2 8)   {$2, 8$}; \\
		\node (index 2 13)  {$2, 13$}; \\
		\node [fill=lightgray](index 6 8)   {$6, 8$}; \\
		\node [fill=lightgray](index 6 13)  {$6, 13$}; \\
		\node (index 10 13) {$10, 13$}; \\
	};

	\draw[snake=brace,raise snake=1mm] (index 2 4.north east) -- (index 2 13.south east);
	\draw[snake=brace,raise snake=1mm] (index 6 8.north east) -- (index 6 13.south east);
	\draw[snake=brace,raise snake=1mm] (index 10 13.north east) -- (index 10 13.south east);
%	\node [anchor=west,right=2mm] at (index 2 8.east) {$(4,6) \ddot{>} q_{X~him~X~it}$};
%	\node [anchor=west,right=2mm] at (index 6 8.south east) {$(4,6) \ddot{=} q_{X~him~X~it}$};
%	\node [anchor=west,right=2mm] at (index 10 13.east) {$(4,6) \ddot{<} q_{X~him~X~it}$};
	\node [anchor=west,right=2mm] at (index 2 8.east) {$\ddot{>}$};
	\node [anchor=west,right=2mm] at (index 6 8.south east) {$\ddot{=}$};
	\node [anchor=west,right=2mm] at (index 10 13.east) {$\ddot{<}$};


	\node (him label) [anchor=south] at (him X it locations.north) {$M_{X~him~X~it}$};
	\node (pair label) [anchor=south] at (it X him X it locations.north) {$M_{it~X~him~X~it}$};
	\node (it label) [anchor=south] at (it X him locations.north) {$M_{it~X~him~X}$};
	\node [anchor=south] at (him label.north) {Input};
	\node [anchor=south] at (pair label.north) {Output};
	\node [anchor=south] at  (it label.north) {Input};

	\fill[lightgray] 
		(index 4 6.south east) --
		(index 4 6.north east) --
		(index 4 6 8.north west) --
		(index 4 6 13.south west) -- cycle;

	\fill[lightgray] 
		(index 4 6 13.south east) --
		(index 4 6 8.north east) --
		(index 6 8.north west) --
		(index 6 13.south west) -- cycle;


	\draw[->] (index 0 2.east) -- (index 0 2 4.west);
	\draw[->] (index 0 2.east) -- (index 0 2 8.west);
	\draw[->] (index 0 2.east) -- (index 0 2 13.west);
	\draw[->] (index 0 6.east) -- (index 0 6 8.west);
	\draw[->] (index 0 6.east) -- (index 0 6 13.west);
	\draw[->] (index 0 10.east) -- (index 0 10 13.west);
	\draw[->] (index 4 6.east) --  (index 4 6 8.west);
	\draw[->] (index 4 6.east) --  (index 4 6 13.west);
	\draw[->] (index 4 10.east) -- (index 4 10 13.west);
	\draw[->] (index 8 10.east) -- (index 8 10 13.west);

	\draw[->] (index 2 4.west) -- (index 0 2 4.east);
	\draw[->] (index 2 8.west) -- (index 0 2 8.east);
	\draw[->] (index 2 13.west) -- (index 0 2 13.east);
	\draw[->] (index 6 8.west) --  (index 0 6 8.east);
	\draw[->] (index 6 13.west) -- (index 0 6 13.east);
	\draw[->] (index 6 8.west) --  (index 4 6 8.east);
	\draw[->] (index 6 13.west) -- (index 4 6 13.east);
	\draw[->] (index 10 13.west) -- (index 0 10 13.east);
	\draw[->] (index 10 13.west) -- (index 4 10 13.east);
	\draw[->] (index 10 13.west) -- (index 8 10 13.east);

\end{tikzpicture}
