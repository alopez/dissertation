\begin{tikzpicture}[node distance=2.25cm]

	\matrix (it X him locations) [nodes={rectangle,draw,minimum width=12mm}]{
		\node (index 0 2)   {$0,2$}; \\
		\node [fill=lightgray](index 0 6)   {$0,6$}; \\
		\node (index 0 10)   {$0,10$}; \\
		\node [fill=lightgray](index 4 6)   {$4,6$}; \\
		\node (index 4 10)   {$4,10$}; \\
		\node (index 4 15)   {$4,15$}; \\
		\node (index 8 10)   {$8,10$}; \\
		\node (index 8 15)   {$8,15$}; \\
		\node (index 13 15)  {$13,15$}; \\
	};

	\node [anchor=east] at (index 0 2.west) {$\ddot{<}$};
	\node [anchor=east] at (index 0 6.west) {$\ddot{=}$};
	\node [anchor=east] at (index 0 10.west) {$\ddot{>}$};
	\node [anchor=east] at (index 4 6.west) {$\ddot{=}$};
	\node [anchor=east] at (index 4 10.west) {$\ddot{>}$};
	\node [anchor=east] at (index 4 15.west) {$\ddot{>}$};
	\node [anchor=east] at (index 8 10.west) {$\ddot{>}$};
	\node [anchor=east] at (index 8 15.west) {$\ddot{>}$};
	\node [anchor=east] at (index 13 15.west) {$\ddot{>}$};

	\matrix (it X him X it locations) [nodes={rectangle,draw,minimum width=17mm},right of=it X him locations,node distance=2.5cm]{
		\node (index 0 2 4)  {$0,2,4$}; \\
		\node (index 0 2 8)  {$0,2,8$}; \\
		\node (index 0 2 13)  {$0,2,13$}; \\
		\node [fill=lightgray](index 0 6 8)  {$0,6,8$}; \\
		\node (index 0 6 13)  {$0,6,13$}; \\
		\node (index 0 10 13)  {$0,10,13$}; \\
		\node [fill=lightgray](index 4 6 8)  {$4,6,8$}; \\
		\node (index 4 6 13)  {$4,6,13$}; \\
		\node (index 4 10 13)  {$4,10,13$}; \\
		\node (index 8 10 13)  {$8,10,13$}; \\
	};


	\matrix (him X it locations) [nodes={rectangle,draw,minimum width=12mm},right of=it X him X it locations,node distance=2.5cm]{
		\node (index 2 4)   {$2, 4$}; \\
		\node (index 2 8)   {$2, 8$}; \\
		\node (index 2 13)  {$2, 13$}; \\
		\node [fill=lightgray](index 6 8)   {$6, 8$}; \\
		\node (index 6 13)  {$6, 13$}; \\
		\node (index 10 13) {$10, 13$}; \\
	};

	\fill[lightgray]
		(index 0 6.south east) --
		(index 0 6.north east) --
		(index 0 6 8.north west) --
		(index 0 6 8.south west) --cycle;

	\fill[lightgray]
		(index 4 6.south east) --
		(index 4 6.north east) --
		(index 4 6 8.north west) --
		(index 4 6 8.south west) --cycle;

	\fill[lightgray]
		(index 0 6 8.south east) --
		(index 0 6 8.north east) --
		(index 6 8.north west) --
		(index 6 8.south west) --cycle;

	\fill[lightgray]
		(index 4 6 8.south east) --
		(index 4 6 8.north east) --
		(index 6 8.north west) --
		(index 6 8.south west) --cycle;



	\node (him label) [anchor=south] at (him X it locations.north) {$M_{him~X~it~X}$};
	\node (pair label) [anchor=south] at (it X him X it locations.north) {$M_{it~X~him~X~it}$};
	\node (it label) [anchor=south] at (it X him locations.north) {$M_{X~it~X~him}$};
	\node [anchor=south] at (him label.north) {Input};
	\node [anchor=south] at (pair label.north) {Output};
	\node [anchor=south] at  (it label.north) {Input};

	\draw[->] (index 0 2.east) -- (index 0 2 4.west);
	\draw[->] (index 0 2.east) -- (index 0 2 8.west);
	\draw[->] (index 0 2.east) -- (index 0 2 13.west);
	\draw[->] (index 0 6.east) -- (index 0 6 8.west);
	\draw[->] (index 0 6.east) -- (index 0 6 13.west);
	\draw[->] (index 0 10.east) -- (index 0 10 13.west);
	\draw[->] (index 4 6.east) --  (index 4 6 8.west);
	\draw[->] (index 4 6.east) --  (index 4 6 13.west);
	\draw[->] (index 4 10.east) -- (index 4 10 13.west);
	\draw[->] (index 8 10.east) -- (index 8 10 13.west);

	\draw[->] (index 2 4.west) -- (index 0 2 4.east);
	\draw[->] (index 2 8.west) -- (index 0 2 8.east);
	\draw[->] (index 2 13.west) -- (index 0 2 13.east);
	\draw[->] (index 6 8.west) --  (index 0 6 8.east);
	\draw[->] (index 6 13.west) -- (index 0 6 13.east);
	\draw[->] (index 6 8.west) --  (index 4 6 8.east);
	\draw[->] (index 6 13.west) -- (index 4 6 13.east);
	\draw[->] (index 10 13.west) -- (index 0 10 13.east);
	\draw[->] (index 10 13.west) -- (index 4 10 13.east);
	\draw[->] (index 10 13.west) -- (index 8 10 13.east);


	\node (separator) [right of=him X it locations,node distance=1.25cm] {}; 
	\draw[gray,thin] (separator.center) -- +(0cm,4cm);
	\draw[gray,thin] (separator.center) -- +(0cm,-3cm);

	\matrix (it X him locations) [nodes={rectangle,draw,minimum width=12mm},right of=him X it locations,node distance=3cm]{
		\node (index 0 2)   {$\colorbox{lightgray}{0},2$}; \\
		\node [fill=lightgray](index 0 6)   {$\colorbox{lightgray}{0},6$}; \\
		\node (index 0 10)   {$\colorbox{lightgray}{0},10$}; \\
		\node [fill=lightgray](index 4 6)   {$\colorbox{lightgray}{4},6$}; \\
		\node (index 4 10)   {$\colorbox{lightgray}{4},10$}; \\
		\node (index 4 15)   {$\colorbox{lightgray}{4},15$}; \\
		\node (index 8 10)   {$8,10$}; \\
		\node (index 8 15)   {$8,15$}; \\
		\node (index 13 15)  {$13,15$}; \\
	};

	\draw[snake=brace,raise snake=1mm] (index 4 15.south west) -- (index 0 2.north west);
	\draw[snake=brace,raise snake=1mm] (index 13 15.south west) -- (index 8 10.north west);
	\node[anchor=east,left=2mm,text width=4mm] at (index 0 10.south west) {$\ddot{<}$, $\ddot{=}$, or $\ddot{>}$};
	\node[anchor=east,left=2mm] at (index 8 15.west) {$\ddot{>}$};

	\matrix (it X him X it locations) [nodes={rectangle,draw,minimum width=17mm},right of=it X him locations,node distance=2.5cm]{
		\node (index 0 2 4)  {$0,2,4$}; \\
		\node (index 0 2 8)  {$0,2,8$}; \\
		\node (index 0 2 13)  {$0,2,13$}; \\
		\node [fill=lightgray](index 0 6 8)  {$0,6,8$}; \\
		\node (index 0 6 13)  {$0,6,13$}; \\
		\node (index 0 10 13)  {$0,10,13$}; \\
		\node [fill=lightgray](index 4 6 8)  {$4,6,8$}; \\
		\node (index 4 6 13)  {$4,6,13$}; \\
		\node (index 4 10 13)  {$4,10,13$}; \\
		\node (index 8 10 13)  {$8,10,13$}; \\
	};


	\matrix (him X it locations) [nodes={rectangle,draw,minimum width=12mm},right of=it X him X it locations,node distance=2.5cm]{
		\node (index 2 4)   {$2, 4$}; \\
		\node (index 2 8)   {$2, 8$}; \\
		\node (index 2 13)  {$2, 13$}; \\
		\node [fill=lightgray](index 6 8)   {$6, 8$}; \\
		\node (index 6 13)  {$6, 13$}; \\
		\node (index 10 13) {$10, 13$}; \\
	};

	\fill[lightgray]
		(index 0 6.south east) --
		(index 0 6.north east) --
		(index 0 6 8.north west) --
		(index 0 6 8.south west) --cycle;

	\fill[lightgray]
		(index 4 6.south east) --
		(index 4 6.north east) --
		(index 4 6 8.north west) --
		(index 4 6 8.south west) --cycle;

	\fill[lightgray]
		(index 0 6 8.south east) --
		(index 0 6 8.north east) --
		(index 6 8.north west) --
		(index 6 8.south west) --cycle;

	\fill[lightgray]
		(index 4 6 8.south east) --
		(index 4 6 8.north east) --
		(index 6 8.north west) --
		(index 6 8.south west) --cycle;

	\node (him label) [anchor=south] at (him X it locations.north) {$M_{X~him~X~it}$};
	\node (pair label) [anchor=south] at (it X him X it locations.north) {$M_{it~X~him~X~it}$};
	\node (it label) [anchor=south] at (it X him locations.north) {$M_{it~X~him~X}$};
	\node [anchor=south] at (him label.north) {Input};
	\node [anchor=south] at (pair label.north) {Output};
	\node [anchor=south] at  (it label.north) {Input};

	\draw[->] (index 0 2.east) -- (index 0 2 4.west);
	\draw[->] (index 0 2.east) -- (index 0 2 8.west);
	\draw[->] (index 0 2.east) -- (index 0 2 13.west);
	\draw[->] (index 0 6.east) -- (index 0 6 8.west);
	\draw[->] (index 0 6.east) -- (index 0 6 13.west);
	\draw[->] (index 0 10.east) -- (index 0 10 13.west);
	\draw[->] (index 4 6.east) --  (index 4 6 8.west);
	\draw[->] (index 4 6.east) --  (index 4 6 13.west);
	\draw[->] (index 4 10.east) -- (index 4 10 13.west);
	\draw[->] (index 8 10.east) -- (index 8 10 13.west);

	\draw[->] (index 2 4.west) -- (index 0 2 4.east);
	\draw[->] (index 2 8.west) -- (index 0 2 8.east);
	\draw[->] (index 2 13.west) -- (index 0 2 13.east);
	\draw[->] (index 6 8.west) --  (index 0 6 8.east);
	\draw[->] (index 6 13.west) -- (index 0 6 13.east);
	\draw[->] (index 6 8.west) --  (index 4 6 8.east);
	\draw[->] (index 6 13.west) -- (index 4 6 13.east);
	\draw[->] (index 10 13.west) -- (index 0 10 13.east);
	\draw[->] (index 10 13.west) -- (index 4 10 13.east);
	\draw[->] (index 10 13.west) -- (index 8 10 13.east);

\end{tikzpicture}
